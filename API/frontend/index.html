.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Busca de Operadoras ANS</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Vue.js -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <!-- Axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    .loading-overlay {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.8);
      z-index: 9999;
    }
    .table-container {
      overflow-x: auto;
    }
    .pagination {
      justify-content: center;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div id="app" class="container mt-4">
    <h1 class="mb-4">Busca de Operadoras ANS</h1>
    
    <!-- Formulário de Busca -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-8">
            <div class="input-group">
              <input 
                type="text" 
                class="form-control" 
                placeholder="Digite sua busca..." 
                v-model="termoBusca"
                @keyup.enter="buscarOperadoras"
              >
              <button 
                class="btn btn-primary" 
                type="button"
                @click="buscarOperadoras"
              >
                Buscar
              </button>
            </div>
            <small class="form-text text-muted">
              Busca por Razão Social, Nome Fantasia, Cidade, UF ou Modalidade
            </small>
          </div>
          
          <div class="col-md-4">
            <select class="form-select" v-model="ordenacao" @change="buscarOperadoras">
              <option value="Razao_Social|asc">Razão Social (A-Z)</option>
              <option value="Razao_Social|desc">Razão Social (Z-A)</option>
              <option value="Cidade|asc">Cidade (A-Z)</option>
              <option value="UF|asc">Estado (A-Z)</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Indicador de carregamento -->
    <div v-if="carregando" class="loading-overlay">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
      <p class="mt-3">Buscando operadoras...</p>
    </div>
    
    <!-- Resultados -->
    <div v-else>
      <div v-if="resultados.length" class="card">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <span><strong>{{ total }}</strong> operadoras encontradas</span>
          <span>Página {{ paginaAtual }} de {{ totalPaginas }}</span>
        </div>
        
        <div class="table-container">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Registro ANS</th>
                <th>Razão Social</th>
                <th>Nome Fantasia</th>
                <th>Modalidade</th>
                <th>Cidade</th>
                <th>UF</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="op in resultados" :key="op.Registro_ANS">
                <td>{{ op.Registro_ANS }}</td>
                <td>{{ op.Razao_Social }}</td>
                <td>{{ op.Nome_Fantasia || '-' }}</td>
                <td>{{ op.Modalidade }}</td>
                <td>{{ op.Cidade }}</td>
                <td>{{ op.UF }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- Paginação -->
        <div class="card-footer">
          <nav aria-label="Navegação de páginas">
            <ul class="pagination">
              <li class="page-item" :class="{ disabled: paginaAtual <= 1 }">
                <a class="page-link" href="#" @click.prevent="mudarPagina(paginaAtual - 1)">Anterior</a>
              </li>
              
              <li 
                v-for="pagina in paginas" 
                :key="pagina"
                class="page-item" 
                :class="{ active: pagina === paginaAtual }"
              >
                <a class="page-link" href="#" @click.prevent="mudarPagina(pagina)">
                  {{ pagina }}
                </a>
              </li>
              
              <li class="page-item" :class="{ disabled: paginaAtual >= totalPaginas }">
                <a class="page-link" href="#" @click.prevent="mudarPagina(paginaAtual + 1)">Próximo</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      
      <div v-else-if="buscaRealizada" class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        Nenhuma operadora encontrada para a busca "{{ termoBusca }}".
      </div>
    </div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        termoBusca: '',
        resultados: [],
        total: 0,
        paginaAtual: 1,
        totalPaginas: 0,
        itensPorPagina: 10,
        ordenacao: 'Razao_Social|asc',
        carregando: false,
        buscaRealizada: false,
        erro: null,
        apiUrl: 'http://localhost:3000/api'
      },
      computed: {
        paginas() {
          const pages = [];
          const maxPagesToShow = 5;
          
          let startPage = Math.max(1, this.paginaAtual - Math.floor(maxPagesToShow/2));
          let endPage = Math.min(this.totalPaginas, startPage + maxPagesToShow - 1);
          
          if (endPage - startPage + 1 < maxPagesToShow) {
            startPage = Math.max(1, endPage - maxPagesToShow + 1);
          }
          
          for (let i = startPage; i <= endPage; i++) {
            pages.push(i);
          }
          
          return pages;
        }
      },
      mounted() {
        this.buscarOperadoras();
      },
      methods: {
        async buscarOperadoras() {
          this.carregando = true;
          this.buscaRealizada = true;
          
          try {
            // Extrair campo e ordem de ordenação
            const [campo, ordem] = this.ordenacao.split('|');
            
            // Determinar o endpoint baseado no termo de busca
            const endpoint = this.termoBusca 
              ? `${this.apiUrl}/operadoras/busca`
              : `${this.apiUrl}/operadoras`;
            
            // Fazer requisição
            const response = await axios.get(endpoint, {
              params: {
                termo: this.termoBusca,
                page: this.paginaAtual,
                limit: this.itensPorPagina,
                sort: campo,
                order: ordem
              }
            });
            
            // Atualizar estado
            this.resultados = response.data.results;
            this.total = response.data.total;
            this.totalPaginas = response.data.totalPages;
            this.paginaAtual = response.data.currentPage;
            
          } catch (error) {
            console.error('Erro na busca:', error);
            this.erro = 'Erro ao buscar operadoras. Por favor, tente novamente.';
            alert('Erro ao conectar com o servidor. Certifique-se que o backend está rodando.');
          } finally {
            this.carregando = false;
          }
        },
        mudarPagina(pagina) {
          if (pagina >= 1 && pagina <= this.totalPaginas) {
            this.paginaAtual = pagina;
            this.buscarOperadoras();
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }
        }
      }
    });
  </script>

  <!-- Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>